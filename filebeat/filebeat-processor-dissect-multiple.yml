filebeat.inputs:
  - type: filestream
    paths:
      - /tmp/example-log-json.log
      - /tmp/example-log-text.log
      - /tmp/example-log-counter.log

processors:
  - if:
      regexp:
        message: "ERROR|WARN|INFO|DEBUG"
    then:
      - add_fields:
          target: ""
          fields:
            message_type: loggen
      - dissect:
          tokenizer: "%{module} %{date} %{time} %{level} %{message}"
          field: "message"
          target_prefix: "dissect.loggen"
          ignore_failure: true
  - if:
      regexp:
        message: "^{"
    then:
      - add_fields:
          target: ""
          fields:
            message_type: json
      - decode_json_fields:
          fields:
            - message
          target: "json"
          add_error_key: true
  - if:
      regexp:
        message: "^\\d+"
    then:
      - add_fields:
          target: ""
          fields:
            message_type: counter
      - dissect:
          tokenizer: "%{counter|integer}"
          field: "message"
          target_prefix: "dissect.counter"
          ignore_failure: true

output.elasticsearch:
  hosts:
    - https://es.k8s.sikademo.com:443
  username: elastic
  password: 7gnOYMA70kbZ71A8D8U62ER2
